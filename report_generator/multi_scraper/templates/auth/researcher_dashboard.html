{% extends 'auth/base.html' %}
{% block content %}
<div class="app-layout">
  <aside class="sidebar">
    <div class="sidebar-brand"><div class="logo-icon">SQ</div> Researcher</div>
    <nav class="sidebar-nav">
      <a href="{{ url_for('researcher_dashboard') }}" class="active"><span class="nav-icon">ğŸ </span> Dashboard</a>
      <a href="{{ url_for('researcher_submissions') }}"><span class="nav-icon">ğŸ“‹</span> My Submissions</a>
      <a href="{{ url_for('tool') }}"><span class="nav-icon">ğŸ”¬</span> Research Tool</a>
      <hr class="sidebar-divider">
      <a href="{{ url_for('profile') }}"><span class="nav-icon">ğŸ‘¤</span> Profile</a>
      <a href="{{ url_for('logout') }}"><span class="nav-icon">ğŸšª</span> Logout</a>
    </nav>
  </aside>

  <main class="main-content">
    <div class="hero-card">
      <h3>Hello, {{ username }} ğŸ‘‹</h3>
      <p>Welcome back to your research dashboard.</p>
    </div>

    <div class="stats-grid">
      <div class="card stat-card">
        <div class="stat-icon" style="background:#ede9fe;">ğŸ“„</div>
        <div class="stat-label">Total Generated</div>
        <div class="stat-value">{{ metrics.total_submissions }}</div>
        <div class="stat-meta">All time reports</div>
      </div>
      <div class="card stat-card">
        <div class="stat-icon" style="background:#fff7e6;">ğŸ“…</div>
        <div class="stat-label">Today</div>
        <div class="stat-value">{{ metrics.today_submissions }}</div>
        <div class="stat-meta">Today's submissions</div>
      </div>
      <div class="card stat-card">
        <div class="stat-icon" style="background:#ecfdf5;">ğŸ•’</div>
        <div class="stat-label">Last Submitted</div>
        <div class="stat-value" style="font-size:18px;line-height:1.4">
          {% if submissions and submissions[0].submitted_at %}
            <span class="ts">{{ submissions[0].submitted_at }}</span>
          {% else %}â€”{% endif %}
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h4 class="card-title">Recent Submissions</h4>
        <div class="search-box"><span class="muted">ğŸ”</span><input id="searchInput" type="text" placeholder="Search market nameâ€¦"></div>
      </div>
      <table class="table-pro">
        <thead>
          <tr>
            <th>Market Name</th>
            <th>Submitted At</th>
            <th>Market Value (2024)</th>
            <th>CAGR</th>
            <th>Segments</th>
            <th>Companies</th>
          </tr>
        </thead>
        <tbody>
          {% for s in submissions %}
          <tr data-market="{{ (s.market_name or '')|lower }}">
            <td class="fw-600">{{ s.market_name or 'â€”' }}</td>
            <td><span class="ts">{{ s.submitted_at or 'â€”' }}</span></td>
            <td>{{ s.value_2024 or 'â€”' }} {{ s.currency or '' }}</td>
            <td>{% if s.cagr %}{{ s.cagr }}%{% else %}â€”{% endif %}</td>
            <td>{{ s.segment_count or 0 }}</td>
            <td>{{ s.company_count or 0 }}</td>
          </tr>
          {% else %}
          <tr><td colspan="6" class="muted text-sm" style="padding:20px;text-align:center">No submissions yet</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </main>
</div>

<script>
(function(){
  const inp = document.getElementById('searchInput');
  if(inp) inp.addEventListener('input', function(){
    const q = this.value.toLowerCase().trim();
    document.querySelectorAll('tbody tr').forEach(r => {
      r.style.display = (!q || (r.dataset.market||'').includes(q)) ? '' : 'none';
    });
  });
})();
</script>
{% endblock %}
